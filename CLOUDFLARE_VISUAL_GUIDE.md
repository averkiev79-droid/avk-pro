# 📸 Визуальное руководство по настройке Cloudflare

## Где найти каждую настройку

### 🔐 Security Level (Уровень безопасности)

**Путь:** `Cloudflare Dashboard → Security → Settings`

**Что искать:**
```
┌─────────────────────────────────────────┐
│ Security Level                          │
│                                         │
│ ○ Essentially Off                       │
│ ○ Low           ← ВЫБРАТЬ ЭТО          │
│ ○ Medium                                │
│ ○ High                                  │
│ ○ I'm Under Attack                      │
└─────────────────────────────────────────┘
```

**Действие:** Выбрать **"Low"** или **"Essentially Off"**

---

### 🤖 Bot Fight Mode

**Путь:** `Cloudflare Dashboard → Security → Bots`

**Что искать:**
```
┌─────────────────────────────────────────┐
│ Bot Fight Mode                          │
│                                         │
│ Protect your site from bot attacks     │
│                                         │
│ [Toggle Switch: OFF] ← ДОЛЖЕН БЫТЬ OFF │
└─────────────────────────────────────────┘
```

**Действие:** Убедиться, что переключатель **выключен (OFF)**

---

### ✅ Browser Integrity Check

**Путь:** `Cloudflare Dashboard → Security → Settings`

**Что искать:**
```
┌─────────────────────────────────────────┐
│ Browser Integrity Check                 │
│                                         │
│ Look for common HTTP headers abused     │
│ by spammers                            │
│                                         │
│ [Toggle Switch: OFF] ← ДОЛЖЕН БЫТЬ OFF │
└─────────────────────────────────────────┘
```

**Действие:** Переключить в положение **OFF**

---

### ⏱️ Challenge Passage

**Путь:** `Cloudflare Dashboard → Security → Settings`

**Что искать:**
```
┌─────────────────────────────────────────┐
│ Challenge Passage                       │
│                                         │
│ How long a visitor has access after     │
│ completing a challenge                  │
│                                         │
│ [ 30 minutes ▼ ] ← ВЫБРАТЬ 30 МИН      │
└─────────────────────────────────────────┘
```

**Действие:** Установить на **30 minutes** или больше

---

## 🔥 Firewall Rules (Расширенная настройка)

### Как создать Firewall Rule для YandexBot

**Путь:** `Cloudflare Dashboard → Security → WAF`

**Шаг 1: Нажать "Create rule"**

**Шаг 2: Заполнить форму**

```
┌─────────────────────────────────────────────────────┐
│ Create firewall rule                                │
├─────────────────────────────────────────────────────┤
│                                                     │
│ Rule name:                                          │
│ [ Allow Yandex Bot                        ]         │
│                                                     │
├─────────────────────────────────────────────────────┤
│ When incoming requests match...                     │
├─────────────────────────────────────────────────────┤
│                                                     │
│ Field:        [User Agent       ▼]                 │
│ Operator:     [contains         ▼]                 │
│ Value:        [YandexBot                  ]         │
│                                                     │
│          [ + OR ]  ← НАЖАТЬ ЗДЕСЬ                  │
│                                                     │
│ Field:        [User Agent       ▼]                 │
│ Operator:     [contains         ▼]                 │
│ Value:        [Yandex                     ]         │
│                                                     │
├─────────────────────────────────────────────────────┤
│ Then take action...                                 │
├─────────────────────────────────────────────────────┤
│                                                     │
│ Action:       [Skip               ▼]               │
│                                                     │
│ Choose which security features to skip:             │
│ ☑ All remaining custom rules                       │
│ ☑ All managed rules                                │
│ ☑ Security level                                   │
│ ☑ Rate limiting                                    │
│                                                     │
└─────────────────────────────────────────────────────┘

                    [ Deploy ]
```

**Шаг 3: Нажать "Deploy"**

---

## 🧪 Проверка в Яндекс.Вебмастере

### Проверка ответа сервера

**Путь:** `Яндекс.Вебмастер → Инструменты → Проверка ответа сервера`

```
┌──────────────────────────────────────────────────┐
│ Проверка ответа сервера                          │
├──────────────────────────────────────────────────┤
│                                                  │
│ URL для проверки:                                │
│ [ https://avk-pro.ru                      ]      │
│                                                  │
│                         [ Проверить ]            │
│                                                  │
└──────────────────────────────────────────────────┘
```

**Ожидаемый результат:**
```
✅ HTTP-код: 200
✅ DNS: успешно разрешен
✅ Подключение: успешно
✅ Загрузка: успешно
```

---

### Переобход страниц

**Путь:** `Яндекс.Вебмастер → Индексирование → Переобход страниц`

```
┌──────────────────────────────────────────────────┐
│ Переобход страниц                                │
├──────────────────────────────────────────────────┤
│                                                  │
│ Добавьте URL для переобхода:                     │
│ [ https://avk-pro.ru/                     ]      │
│                                                  │
│                         [ Добавить ]             │
│                                                  │
├──────────────────────────────────────────────────┤
│ Список URL для переобхода:                       │
│                                                  │
│ ✓ https://avk-pro.ru/                  В очереди│
│ ✓ https://avk-pro.ru/catalog           В очереди│
│ ✓ https://avk-pro.ru/blog              В очереди│
│                                                  │
└──────────────────────────────────────────────────┘
```

---

## 📊 Мониторинг в Cloudflare

### Security Events

**Путь:** `Cloudflare Dashboard → Security → Overview → Security Events`

**Что искать:**
```
┌─────────────────────────────────────────────────────────────────┐
│ Security Events                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ Фильтр:  [ User Agent contains "Yandex"              ]  [Apply]│
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│ Timestamp  │ Action │ User Agent        │ IP           │ Rule   │
├────────────┼────────┼───────────────────┼──────────────┼────────┤
│ 10:30:15   │ Allow  │ YandexBot/3.0     │ 5.255.x.x   │ Manual │
│ 10:29:43   │ Allow  │ YandexBot/3.0     │ 5.255.x.x   │ Manual │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Что должно быть:**
- Action: **Allow** (разрешено)
- НЕ должно быть: Block, Challenge, Managed Challenge

**Если видите Block:**
1. Кликнуть на событие
2. Посмотреть причину блокировки
3. Создать правило Skip для этой причины

---

## 🎯 Типичные ошибки и их исправление

### ❌ Ошибка 1: "Bot Fight Mode включен"

**Признак:** В Security Events видны Challenge для YandexBot

**Решение:**
```
Security → Bots → Bot Fight Mode → OFF
```

### ❌ Ошибка 2: "Security Level слишком высокий"

**Признак:** Много событий Challenge/Block для ботов

**Решение:**
```
Security → Settings → Security Level → Low
```

### ❌ Ошибка 3: "Firewall Rule не работает"

**Признак:** YandexBot все еще блокируется

**Решение:**
1. Проверить порядок правил (Firewall Rules → Список правил)
2. Rule для YandexBot должно быть **первым** или **высоким** в списке
3. Перетащить его наверх, если нужно

### ❌ Ошибка 4: "DNS все еще не резолвится"

**Признак:** Яндекс.Вебмастер показывает ошибку DNS

**Решение:**
1. Проверить в `Cloudflare → DNS → Records`
2. Убедиться, что A-запись для домена существует
3. Убедиться, что NS-записи указывают на Cloudflare
4. Подождать 24 часа для пропагации

---

## 📞 Где получить помощь

### Cloudflare Community
https://community.cloudflare.com/

### Яндекс.Вебмастер Справка
https://yandex.ru/support/webmaster/

### Проверка статуса Cloudflare
https://www.cloudflarestatus.com/

---

## ✅ Финальный чеклист

Отметьте каждый пункт после выполнения:

- [ ] Открыл Cloudflare Dashboard
- [ ] Выбрал домен avk-pro.ru
- [ ] Security Level → Low ✓
- [ ] Bot Fight Mode → OFF ✓
- [ ] Browser Integrity Check → OFF ✓
- [ ] Challenge Passage → 30 minutes ✓
- [ ] (Опционально) Создал Firewall Rule для YandexBot ✓
- [ ] Подождал 10 минут ⏱️
- [ ] Проверил в Яндекс.Вебмастере ✓
- [ ] Запросил переобход страниц ✓
- [ ] Настроил мониторинг на 3-5 дней 📊

**Дата выполнения:** __________________

**Результат:** __________________

---

**Примечание:** Если возникнут сложности, обратитесь к файлу `CLOUDFLARE_PAGE_RULE_SETUP.md` для более подробных инструкций.
