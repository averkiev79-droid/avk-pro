import { useState, useEffect } from 'react';
import { useParams, useLocation } from 'react-router-dom';
import { Card } from '../components/ui/card';
import axios from 'axios';

const BACKEND_URL = process.env.REACT_APP_BACKEND_URL || '';

const LegalPage = () => {
  const { pageType: paramPageType } = useParams();
  const location = useLocation();
  const [page, setPage] = useState({ title: '', content: '' });
  const [loading, setLoading] = useState(true);
  
  // Определяем pageType из URL (например, /privacy -> privacy)
  const pageType = paramPageType || location.pathname.replace('/', '');

  useEffect(() => {
    fetchPage();
  }, [pageType]);

  const fetchPage = async () => {
    try {
      const response = await axios.get(`${BACKEND_URL}/api/legal-pages/${pageType}`);
      setPage(response.data);
    } catch (error) {
      console.error('Error fetching legal page:', error);
    } finally {
      setLoading(false);
    }
  };

  const defaultContent = {
    privacy: {
      title: 'Политика конфиденциальности',
      content: `
        <h2>1. Общие положения</h2>
        <p>Настоящая Политика конфиденциальности определяет порядок обработки и защиты персональных данных пользователей сайта A.V.K. SPORT (далее — "Сайт").</p>
        
        <h2>2. Персональные данные</h2>
        <p>Под персональными данными понимается информация, предоставленная пользователем при заполнении форм на Сайте, включая:</p>
        <ul>
          <li>ФИО</li>
          <li>Номер телефона</li>
          <li>Адрес электронной почты</li>
          <li>Название организации/команды</li>
          <li>Адрес доставки</li>
        </ul>

        <h2>3. Цели обработки персональных данных</h2>
        <p>Мы обрабатываем ваши персональные данные для:</p>
        <ul>
          <li>Обработки и выполнения заказов</li>
          <li>Связи с вами по вопросам заказа</li>
          <li>Информирования о статусе заказа</li>
          <li>Улучшения качества обслуживания</li>
          <li>Проведения маркетинговых акций (с вашего согласия)</li>
        </ul>

        <h2>4. Защита персональных данных</h2>
        <p>Мы принимаем необходимые меры для защиты ваших персональных данных от несанкционированного доступа, изменения, раскрытия или уничтожения.</p>

        <h2>5. Передача данных третьим лицам</h2>
        <p>Мы не передаем ваши персональные данные третьим лицам, за исключением случаев, предусмотренных законодательством РФ.</p>

        <h2>6. Ваши права</h2>
        <p>Вы имеете право:</p>
        <ul>
          <li>Получить информацию о своих персональных данных</li>
          <li>Требовать исправления неточных данных</li>
          <li>Требовать удаления ваших данных</li>
          <li>Отозвать согласие на обработку данных</li>
        </ul>

        <h2>7. Контактная информация</h2>
        <p>По вопросам обработки персональных данных обращайтесь:<br/>
        Email: simplepay@mail.ru<br/>
        Телефон: +7 (812) 317-73-19</p>

        <p><em>Последнее обновление: ${new Date().toLocaleDateString('ru-RU')}</em></p>
      `
    },
    terms: {
      title: 'Пользовательское соглашение',
      content: `
        <h2>1. Общие положения</h2>
        <p>Настоящее Пользовательское соглашение регулирует отношения между A.V.K. SPORT (далее — "Компания") и пользователями сайта (далее — "Пользователь").</p>
        
        <h2>2. Использование сайта</h2>
        <p>Используя данный сайт, вы соглашаетесь с условиями настоящего Соглашения. Если вы не согласны с условиями, пожалуйста, не используйте сайт.</p>

        <h2>3. Услуги</h2>
        <p>Компания предоставляет услуги по производству хоккейной экипировки:</p>
        <ul>
          <li>Хоккейные свитера (джерси)</li>
          <li>Гамаши</li>
          <li>Тренировочная форма</li>
          <li>Куртки</li>
          <li>Индивидуальный дизайн</li>
        </ul>

        <h2>4. Оформление заказа</h2>
        <p>4.1. Минимальная партия заказа — от 10 штук<br/>
        4.2. Заказ считается принятым после подтверждения менеджером<br/>
        4.3. Сроки изготовления согласовываются индивидуально<br/>
        4.4. Цена указывается в рублях РФ</p>

        <h2>5. Оплата</h2>
        <p>5.1. Оплата производится по безналичному расчету<br/>
        5.2. Предоплата составляет 50% от стоимости заказа<br/>
        5.3. Окончательный расчет — при получении заказа</p>

        <h2>6. Доставка</h2>
        <p>6.1. Доставка осуществляется по всей России<br/>
        6.2. Стоимость доставки рассчитывается индивидуально<br/>
        6.3. Самовывоз из г. Санкт-Петербург</p>

        <h2>7. Возврат и обмен</h2>
        <p>7.1. Возврат возможен в течение 14 дней при наличии производственного брака<br/>
        7.2. Товар надлежащего качества возврату не подлежит<br/>
        7.3. Индивидуальные заказы возврату не подлежат</p>

        <h2>8. Ответственность</h2>
        <p>8.1. Компания не несет ответственности за неточности в дизайне, согласованном Пользователем<br/>
        8.2. Компания не несет ответственности за задержки, вызванные форс-мажорными обстоятельствами</p>

        <h2>9. Контакты</h2>
        <p>Email: simplepay@mail.ru<br/>
        Телефон: +7 (812) 317-73-19<br/>
        Адрес: г. Санкт-Петербург</p>

        <p><em>Последнее обновление: ${new Date().toLocaleDateString('ru-RU')}</em></p>
      `
    },
    requisites: {
      title: 'Реквизиты компании',
      content: `
        <h2>Юридическая информация</h2>
        
        <p><strong>Полное наименование:</strong> Индивидуальный предприниматель [Укажите ФИО]</p>
        <p><strong>Сокращенное наименование:</strong> ИП [Укажите ФИО]</p>
        <p><strong>ИНН:</strong> [Укажите ИНН]</p>
        <p><strong>ОГРНИП:</strong> [Укажите ОГРНИП]</p>
        
        <h2>Банковские реквизиты</h2>
        <p><strong>Расчётный счёт:</strong> [Укажите номер счета]</p>
        <p><strong>Банк:</strong> [Название банка]</p>
        <p><strong>БИК:</strong> [БИК банка]</p>
        <p><strong>Корр. счёт:</strong> [Корреспондентский счет]</p>
        
        <h2>Контактная информация</h2>
        <p><strong>Юридический адрес:</strong> [Укажите адрес]</p>
        <p><strong>Фактический адрес:</strong> г. Санкт-Петербург</p>
        <p><strong>Телефон:</strong> +7 (812) 317-73-19</p>
        <p><strong>Email:</strong> simplepay@mail.ru</p>
        
        <p><em>Примечание: Для получения актуальных реквизитов свяжитесь с нами</em></p>
      `
    },
    cookies: {
      title: 'Политика использования файлов cookie',
      content: `
        <h2>1. Что такое cookie?</h2>
        <p>Cookie (куки) — это небольшие текстовые файлы, которые сохраняются на вашем устройстве при посещении сайта. Они помогают сайту запомнить информацию о вашем визите.</p>

        <h2>2. Какие cookie мы используем</h2>
        
        <h3>2.1. Необходимые cookie</h3>
        <p>Эти файлы необходимы для корректной работы сайта. Они включают:</p>
        <ul>
          <li>Cookies сессии</li>
          <li>Cookies безопасности</li>
          <li>Настройки отображения сайта</li>
        </ul>

        <h3>2.2. Функциональные cookie</h3>
        <p>Эти файлы запоминают ваши предпочтения:</p>
        <ul>
          <li>Язык интерфейса</li>
          <li>Товары в корзине</li>
          <li>Согласие на использование cookie</li>
        </ul>

        <h3>2.3. Аналитические cookie</h3>
        <p>Помогают понять, как посетители используют сайт:</p>
        <ul>
          <li>Статистика посещений</li>
          <li>Популярные страницы</li>
          <li>Время на сайте</li>
        </ul>

        <h2>3. Как управлять cookie</h2>
        <p>Вы можете контролировать и/или удалять cookie по своему усмотрению:</p>
        
        <h3>В браузере Google Chrome:</h3>
        <p>Настройки → Конфиденциальность и безопасность → Файлы cookie и другие данные сайтов</p>

        <h3>В браузере Mozilla Firefox:</h3>
        <p>Настройки → Приватность и защита → Куки и данные сайтов</p>

        <h3>В браузере Safari:</h3>
        <p>Настройки → Конфиденциальность → Управление данными веб-сайтов</p>

        <h2>4. Последствия отключения cookie</h2>
        <p>При отключении cookie некоторые функции сайта могут работать некорректно:</p>
        <ul>
          <li>Невозможность добавить товары в корзину</li>
          <li>Сброс настроек при каждом визите</li>
          <li>Проблемы с оформлением заказа</li>
        </ul>

        <h2>5. Контакты</h2>
        <p>Вопросы по использованию cookie:<br/>
        Email: simplepay@mail.ru<br/>
        Телефон: +7 (812) 317-73-19</p>

        <p><em>Последнее обновление: ${new Date().toLocaleDateString('ru-RU')}</em></p>
      `
    }
  };

  const displayPage = page.title ? page : defaultContent[pageType] || page;

  if (loading) {
    return (
      <div className="container py-20 text-center">
        <p className="text-gray-600">Загрузка...</p>
      </div>
    );
  }

  return (
    <div className="legal-page bg-white min-h-screen">
      {/* Header */}
      <section className="bg-gray-900 text-white py-20">
        <div className="container max-w-4xl mx-auto px-4">
          <h1 className="text-4xl md:text-5xl font-bold text-center">{displayPage.title}</h1>
        </div>
      </section>

      {/* Content */}
      <div className="container max-w-4xl mx-auto py-16 px-4">
        <div className="bg-white">
          {displayPage.content ? (
            <div 
              className="legal-content prose prose-lg max-w-none"
              dangerouslySetInnerHTML={{ __html: displayPage.content }}
              style={{
                lineHeight: '1.8'
              }}
            />
          ) : (
            <div className="text-center py-12">
              <p className="text-gray-500">Содержимое страницы не заполнено</p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default LegalPage;
